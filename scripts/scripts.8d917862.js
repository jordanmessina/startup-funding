function sortByKey(a,b){return a.sort(function(a,c){var d=a[b],e=c[b];return d>e?-1:e>d?1:0})}function Founder(a,b){this.name=a,this.equity=b}function Investor(a){this.name=a,this.investments=[]}function ConvertibleNote(a,b){this.cap=a,this.discount=b,this.investments=[]}function EquityRound(a){this.preMoneyValuation=a,this.investments=[]}function Investment(a,b,c){this.investor=a,this.investmentTerms=b,this.amount=c;for(var d=b.investments.length,e=!1,f=0;d>f;f++)b.investments[f].investor===a&&(e=!0);var g=this;e||(this.investor.investments.push(g),this.investmentTerms.investments.push(g))}function Startup(){this.founders=[],this.investors=[],this.convertibleNotes=[],this.equityRounds=[]}Investor.prototype.deleteInvestment=function(a){var b=this.investments.indexOf(a);if(-1!=b){var c=this.investments[b].investmentTerms;c.deleteInvestment(this.investments[b])}},Investor.prototype.deleteInvestments=function(){for(;this.investments.length;){var a=this.investments[0].investmentTerms;a.deleteInvestment(this.investments[0])}},Investor.prototype.totalInvestment=function(){for(var a=this.investments.length,b=0,c=0;a>c;c++)b+=this.investments[c].amount;return b},ConvertibleNote.prototype.addInvestor=function(a,b){new Investment(a,this,b)},ConvertibleNote.prototype.deleteInvestment=function(a){var b=this.investments.indexOf(a);if(-1!=b){var c=this.investments[b].investor,d=c.investments.indexOf(a);-1!=d&&c.investments.splice(d,1),this.investments.splice(b,1)}},ConvertibleNote.prototype.deleteInvestments=function(){for(;this.investments.length;)this.deleteInvestment(this.investments[0])},ConvertibleNote.prototype.totalInvestment=function(){for(var a=this.investments.length,b=0,c=0;a>c;c++)b+=this.investments[c].amount;return b},EquityRound.prototype.addInvestor=function(a,b){new Investment(a,this,b)},EquityRound.prototype.deleteInvestment=function(a){var b=this.investments.indexOf(a);if(-1!=b){var c=this.investments[b].investor,d=c.investments.indexOf(a);-1!=d&&c.investments.splice(d,1),this.investments.splice(b,1)}},EquityRound.prototype.deleteInvestments=function(){for(;this.investments.length;)this.deleteInvestment(this.investments[0])},EquityRound.prototype.totalInvestment=function(){for(var a=this.investments.length,b=0,c=0;a>c;c++)b+=this.investments[c].amount;return b},Investment.prototype.deleteInvestment=function(){this.investor.deleteInvestment(this),this.investmentTerms.deleteInvestment(this)},Startup.prototype.totalFounderEquity=function(){for(var a=0,b=this.founders.length,c=0;b>c;c++)a+=this.founders[c].equity;return a},Startup.prototype.addFounder=function(a){this.totalFounderEquity()<100&&a.equity+this.totalFounderEquity()<=100&&(this.founders.push(a),this.founders=sortByKey(this.founders,"equity"))},Startup.prototype.removeFounder=function(a){var b=this.founders.indexOf(a);-1!=b&&this.founders.splice(b,1)},Startup.prototype.removeInvestor=function(a){a.deleteInvestments()},Startup.prototype.gatherInvestors=function(){for(var a=[],b=this.convertibleNotes.length,c=this.equityRounds.length,d=0;b>d;d++)for(var e=this.convertibleNotes[d].investments.length,f=0;e>f;f++){var g=this.convertibleNotes[d].investments[f].investor;-1==a.indexOf(g)&&a.push(g)}for(var h=0;c>h;h++)for(var e=this.equityRounds[h].investments.length,f=0;e>f;f++){var g=this.equityRounds[h].investments[f].investor;-1==a.indexOf(g)&&a.push(g)}this.investors=a},Startup.prototype.addConvertibleNote=function(a){-1==this.convertibleNotes.indexOf(a)&&this.convertibleNotes.push(a)},Startup.prototype.removeConvertibleNote=function(a){var b=this.convertibleNotes.indexOf(a);-1!=b&&(a.deleteInvestments(),this.convertibleNotes.splice(b,1))},Startup.prototype.addEquityRound=function(a){-1==this.equityRounds.indexOf(a)&&this.equityRounds.push(a)},Startup.prototype.removeEquityRound=function(a){var b=this.equityRounds.indexOf(a);-1!=b&&(a.deleteInvestments(),this.equityRounds.splice(b,1))},Startup.prototype.capTable=function(){this.gatherInvestors();var a=[];if(0==this.equityRounds.length||0!=this.equityRounds.length&&0==this.equityRounds[0].investments.length){for(var b=this.founders.length,c=0;b>c;c++)a.push({person:this.founders[c],equity:this.founders[c].equity});for(var d=this.investors.length,e=0;d>e;e++)a.push({person:this.investors[e],equity:0});return sortByKey(a,"equity")}for(var f=this.equityRounds[0].preMoneyValuation,g=this.equityRounds[0].totalInvestment(),h=g/(g+f)*100,i=this.equityRounds[0].investments.length,j=0;i>j;j++){var k=this.equityRounds[0].investments[j];a.push({person:k.investor,equity:k.amount/(g+f)*100})}for(var l=this.convertibleNotes.length,m=0,n=0;l>n;n++)for(var o=this.convertibleNotes[n].cap,p=this.convertibleNotes[n].discount,q=this.convertibleNotes[n].investments.length,j=0;q>j;j++){var k=this.convertibleNotes[n].investments[j],r=Math.max(k.amount/((100-p)/100*f)*100,k.amount/Math.min(o,f)*100);r*=(100-h)/100;for(var s=a.length,t=-1,u=0;s>u;u++)a[u].person===k.investor&&(t=u);-1!=t?a[t].equity+=r:a.push({person:k.investor,equity:r}),m+=r}for(var v=h+m,b=this.founders.length,w=0;b>w;w++){var x=this.founders[w],r=x.equity*((100-v)/100);a.push({person:x,equity:r})}var y=this.equityRounds.length-1;if(y>0)for(var z=1;y>=z;z++){for(var f=this.equityRounds[z].preMoneyValuation,A=this.equityRounds[z].totalInvestment(),B=A/(A+f)*100,C=this.equityRounds[z].investments.length,s=a.length,u=0;s>u;u++)a[u].equity=a[u].equity*((100-B)/100);for(var j=0;C>j;j++){for(var k=this.equityRounds[z].investments[j],r=k.amount/(A+f)*100,s=a.length,t=-1,u=0;s>u;u++)a[u].person===k.investor&&(t=u);-1!=t?a[t].equity+=r:a.push({person:k.investor,equity:r})}}return sortByKey(a,"equity")};var app=angular.module("fundingApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html"}).otherwise({redirectTo:"/"})}]);angular.module("fundingApp").factory("startupService",["$log",function(){var a={startup:new Startup,investors:[],capTable:[]};return a.updateCapTable=function(){a.capTable=a.startup.capTable()},a}]),angular.module("fundingApp").controller("FoundersCtrl",["$scope","$log","startupService",function(a,b,c){a.founders=c.startup.founders,a.addFounder=function(){c.startup.addFounder(a.newFounder),a.newFounder={},c.updateCapTable()},a.removeFounder=function(b){c.startup.removeFounder(a.founders[b]),c.updateCapTable()},a.totalFounderEquity=c.startup.totalFounderEquity}]).directive("startupFounders",function(){return{templateUrl:"templates/founders.html"}}),angular.module("fundingApp").controller("InvestorsCtrl",["$scope","$log","startupService",function(a,b,c){a.investors=c.investors,a.addInvestor=function(){c.investors.push(new Investor(a.newInvestor.name)),a.newInvestor={}},a.removeInvestor=function(b){c.startup.removeInvestor(a.investors[b]),c.investors.splice(b,1)},a.noDuplicateInvestors=function(){for(var b=a.investors.length,c=0;b>c;c++)if(a.investors[c].name==a.newInvestor.name)return!1;return!0}}]).directive("startupInvestors",function(){return{templateUrl:"templates/investors.html"}}),angular.module("fundingApp").controller("ConvertibleNotesCtrl",["$scope","$log","startupService",function(a,b,c){a.founders=c.startup.founders,a.investors=c.investors,a.convertibleNotes=c.startup.convertibleNotes,a.addConvertibleNote=function(){c.startup.addConvertibleNote(new ConvertibleNote(a.newConvertibleNote.cap,a.newConvertibleNote.discount)),a.newConvertibleNote={}},a.removeConvertibleNote=function(b){c.startup.removeConvertibleNote(a.convertibleNotes[b]),c.updateCapTable()},a.addInvestorToConvertibleNote=function(b){c.startup.convertibleNotes[b].addInvestor(a.investors[a.investorToAddToConvertibleNote.investor],a.investorToAddToConvertibleNote.amount),a.investorToAddToConvertibleNote={},c.updateCapTable()},a.removeInvestorFromConvertibleNote=function(b,d){var e=a.convertibleNotes[b];e.deleteInvestment(e.investments[d]),c.updateCapTable()}}]).directive("convertibleNotes",function(){return{templateUrl:"templates/convertiblenotes.html"}}),angular.module("fundingApp").controller("EquityRoundsCtrl",["$scope","$log","startupService",function(a,b,c){a.founders=c.startup.founders,a.investors=c.investors,a.equityRounds=c.startup.equityRounds,a.addEquityRound=function(){c.startup.addEquityRound(new EquityRound(a.newEquityRound.preMoneyValuation)),a.newEquityRound={}},a.removeEquityRound=function(b){c.startup.removeEquityRound(a.equityRounds[b]),c.updateCapTable()},a.addInvestorToEquityRound=function(b){c.startup.equityRounds[b].addInvestor(a.investors[a.investorToAddToEquityRound.investor],a.investorToAddToEquityRound.amount),a.investorToAddToEquityRound={},c.updateCapTable()},a.removeInvestorFromEquityRound=function(b,d){var e=a.equityRounds[b];e.deleteInvestment(e.investments[d]),c.updateCapTable()},a.totalRaised=c.totalRaised}]).directive("equityRounds",function(){return{templateUrl:"templates/equityrounds.html"}}),angular.module("fundingApp").controller("FinalEquityCtrl",["$scope","$log","startupService",function(a,b,c){a.founders=c.startup.founders,a.startupService=c}]).directive("finalEquity",function(){return{templateUrl:"templates/finalequity.html"}});